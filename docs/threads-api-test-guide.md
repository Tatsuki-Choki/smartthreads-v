# Threads API 連携テストガイド

## 🧪 テストの目的

SmartThreadsとThreads APIの連携が正常に動作することを確認します。

## 📋 前提条件

1. **Threads開発者アカウント**
   - [Meta for Developers](https://developers.facebook.com)でアプリ作成済み
   - Threads APIアクセス権限を取得済み

2. **環境変数設定**
   ```env
   THREADS_APP_ID=your_app_id
   THREADS_APP_SECRET=your_app_secret
   THREADS_TOKEN_ENC_KEY=your_encryption_key
   ```

3. **開発サーバー起動**
   ```bash
   npm run dev
   ```

## 🚀 テスト手順

### 方法1: 自動テストスクリプト

```bash
# テストスクリプトを実行
node scripts/test-threads-api.js
```

このスクリプトは以下を自動でテストします：
- ✅ ユーザー認証
- ✅ ワークスペース取得
- ✅ Threadsアカウント連携確認
- ✅ テスト投稿作成
- ✅ Threads APIへの公開

### 方法2: 手動テスト（ブラウザ）

1. **ログイン**
   - http://localhost:3000/login にアクセス
   - Supabaseアカウントでログイン

2. **Threads連携**
   - 設定ページ（http://localhost:3000/settings）へ移動
   - 「Threadsアカウント連携」をクリック
   - アクセストークンを入力して連携

3. **テスト投稿作成**
   - 新規投稿ページ（http://localhost:3000/posts/new）へ移動
   - テスト内容を入力：
     ```
     SmartThreadsからのテスト投稿 🚀
     
     #SmartThreads #テスト
     ```
   - 「今すぐ投稿」をクリック

4. **結果確認**
   - 投稿履歴（http://localhost:3000/posts/history）で確認
   - Threadsアプリで実際の投稿を確認

## 🧪 テスト項目チェックリスト

### 基本機能

- [ ] **テキスト投稿**
  - 通常のテキスト投稿が可能
  - 500文字以内の制限が機能
  - 絵文字・改行が正しく処理される

- [ ] **画像付き投稿**
  - 画像のアップロード
  - サムネイル表示
  - Threadsへの画像投稿

- [ ] **動画付き投稿**
  - 動画のアップロード（MP4、MOV）
  - 10MB以下の制限
  - Threadsへの動画投稿

- [ ] **カルーセル投稿**
  - 複数画像の選択
  - 各画像へのキャプション追加
  - カルーセル形式での投稿

### 予約投稿

- [ ] **予約設定**
  - 日時の選択
  - 未来の日時のみ選択可能
  - タイムゾーンの正しい処理

- [ ] **自動送信（Cronジョブ）**
  - 5分ごとの実行
  - 予約時刻での自動投稿
  - エラー時のリトライ

### スレッド投稿

- [ ] **連続投稿**
  - 複数の投稿を作成
  - 親子関係の設定
  - スレッド形式での表示

### エラーハンドリング

- [ ] **レート制限**
  - 60投稿/時間の制限
  - エラーメッセージ表示
  - 制限解除までの待機時間表示

- [ ] **ネットワークエラー**
  - オフライン時の処理
  - タイムアウト処理
  - リトライ機能

- [ ] **認証エラー**
  - トークン期限切れ
  - 無効なトークン
  - 再認証フロー

## 🔍 トラブルシューティング

### 問題: "アクセストークンが無効です"

**原因**: Threadsアクセストークンが正しくない、または期限切れ

**解決方法**:
1. Meta for Developersでトークンを再生成
2. 設定ページで新しいトークンを入力
3. 連携をやり直す

### 問題: "レート制限に達しました"

**原因**: 1時間に60回以上の投稿を試みた

**解決方法**:
1. 1時間待つ
2. または別のThreadsアカウントを使用

### 問題: "メディアのアップロードに失敗"

**原因**: ファイルサイズが大きすぎる、またはSupabase Storageの設定問題

**解決方法**:
1. ファイルサイズを10MB以下に
2. Supabaseダッシュボードで`media`バケットを確認
3. バケットをPublicに設定

### 問題: "投稿が表示されない"

**原因**: Threads APIの処理遅延

**解決方法**:
1. 数分待つ（メディア処理に時間がかかる場合がある）
2. Threadsアプリを更新
3. 投稿履歴でステータスを確認

## 📊 パフォーマンス目標

- **テキスト投稿**: 3秒以内
- **画像付き投稿**: 10秒以内
- **動画付き投稿**: 30秒以内
- **予約投稿処理**: 5分以内に実行

## 🎯 成功基準

以下がすべて達成できれば、Threads API連携は成功です：

1. ✅ テキスト投稿が正常に公開される
2. ✅ 画像付き投稿が正常に公開される
3. ✅ 予約投稿が指定時刻に公開される
4. ✅ エラー時に適切なメッセージが表示される
5. ✅ 投稿履歴でステータスが確認できる

## 📝 テスト結果記録

| 項目 | 結果 | 備考 |
|------|------|------|
| テキスト投稿 | - | - |
| 画像投稿 | - | - |
| 動画投稿 | - | - |
| カルーセル | - | - |
| 予約投稿 | - | - |
| スレッド | - | - |
| レート制限 | - | - |

## 🚨 注意事項

- **本番環境でのテスト**: 実際のThreadsアカウントに投稿されます
- **削除不可**: 一度投稿したものはAPIから削除できません
- **レート制限**: テストでも制限にカウントされます
- **プライバシー**: テスト内容に個人情報を含めないでください